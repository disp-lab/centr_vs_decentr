# centr_vs_decentr
Models comparing centralised and decentralised decision making in a variant of MTSP (Multiple Travelling Salesmen Problem) in AnyLogic 7.3.2 using CPLEX 12.6.3.0

Content:
- 1/ INTRODUCTION
- 2/ RUN THE MODEL IN ANYLOGIC
- 3/ DATA GENERATED BY THE ANYLOGIC MODEL
- 4/ GENERATION OF THE FIGURES BY R

*******************************************

1/ INTRODUCTION

This repository contains the material developped for the article "Cost of selfishness in the allocation of cities in the Multiple Travelling Salesmen Problem" written by Thierry Moyaux and Eric Marcon and published in "Engineering Applications of Artificial Intelligence" in 2019 (https://doi.org/10.1016/j.engappai.2019.103429).

Section 2 details how to reproduce the experiments in this article. Section 3 explains the meaning of the XLS Excel files produced from these experiments. Section 4 shows how to use the R scripts to transform these XLS files into EPS images.

The version of the softwares used are:
- AnyLogic 7.3.2 PLE
- IBM ILOG CPLEX 12.6.3.0 (we use the Academic Initiative to obtain a free version)
- OjAlgoc 40.0

The content of the directories is as follows:
- CPLEX_linux64\  -> Directory with 13 empty files. If you use Linux 64 bits, you need to obtain these files from IBM.
- CPLEX_mac\  -> Directory with 12 empty files. If you use MacOS, you need to obtain these files from IBM.
- CPLEX_win64\  -> Directory with 14 empty files. If you use Windows 64 bits, you need to obtain these files from IBM.
- MTSP\  -> Directory with all files except CPLEX

  MTSP\anylogic\  -> Directory with the AnyLogic model
  
  MTSP\anylogic\cache\  -> Directory with 3 files created by AnyLogic
  
  MTSP\anylogic\database\  -> Directory with 3 files and 1 empty repository created by AnyLogic (We have not used the database provided in all AnyLogic models.)
  
  MTSP\anylogic\MTSP.alp  -> The file to be opened in AnyLogic
  
  MTSP\anylogic\cplex.jar  -> Empty file to be replaced by yours after you obtained it from IBM.
  
  MTSP\anylogic\ojalgo-40.0.0.jar  -> Empty file to be replaced by yours after you obtained it from https://www.ojalgo.org/
  
  MTSP\anylogic\output.csv  -> The last results saved by the Parameter Variation Experiment "ParamVar"
  
  MTSP\results\  -> Experimental results copied/pasted from MTSP\anylogic\output.csv. "Swap" refers to the constraint of 1-1 exchanges described in section 2.2 in the article, i.e., to our version of MTSP. Hence, "without_swap" refers to the traditional MTSP.
  
  MTSP\figures\  -> The figures 6, 7, 8, 9 and 10 in the article with the R code to generate them from the Excel files

*******************************************

2/ RUN THE MODEL IN ANYLOGIC

2.1/ Download AnyLogic 7.3.2 PLE from https://www.anylogic.com/, install it and start it.

2.2/ In AnyLogic, open the file MTSP\anylogic\MTSP.alp. Right-click on "Simulation:Main" and click "Run". The console may have errors when AnyLogic does not find cplex.jar ("IloCplex cannot be resolved to a variables" or ""IloException cannot be resolved to a type") or ojalgo-40.0.0.jar ("ExpressionsBasedModel cannot be resolved to a type"). In ordre to fix this problem, in the "Projects" pane, click on MTSP, which shows its properties in the "Properties" pane; in the "Dependencies" section, remove the two aforementioned jar file then add them pointing to the good location on your hard drive.

2.3/ When you run "Simulation:Main", you may see in the console a 47-line error message starting by "java.lang.UnsatisfiedLinkError: no cplex1263 in java.library.path". This means that Java has not found the binaries of CPLEX. In ordert to fix this problem, in the "Projects" pane, click on "Simulation: Main", next in the "Properties" pane, in the section "Advanced Java", update the line "Java machine arguments" (open the section "Description" to see how to adapt this line to Linux, MacOS and Windows). When "Simulation: Main" run without errors, do the same modification to "ParamVar: Main".

*******************************************

3/ DATA GENERATED BY THE ANYLOGIC MODEL

After each run of "ParamVar: Main", the result of this run is saved as an additional line at the bottom of MTSP\anylogic\output.csv. In this files, the meaning of each column is as follows (the name between parentheses is the name appearing in the section "Parameters" in "ParamVar: Main"):
- Column 1 (problemID): CH130 means that the location of the clients is based on http://comopt.ifi.uni-heidelberg.de/software/TSPLIB95/tsp/ch130.tsp.gz.
- Column 2 (selectedAllocationMechanism=FullCentr if 0, =OptDecent if 1, =Cluster if 3, (=the cluster described in footnote 10 in the article if 4), =Auction if 5, =P2P if 6, =CNP if 7, =NoRealloc if 8 -- in the same order as the radio buttons under the map in "Simulation: main"): OptDecentr_0.5 means that mechanism OptDecentr was used with a time limit of 0.5 hour.
- Column 3 (instance): The index "Delta Y" of this instance described in the introduction of Section 5 in the article.
- Column 4 (salesmanNumber): Number m of trucks/salesmen
- Column 5 (cityNumber): Number n of cities/clients
- Columns 6 and 7: 1139+986+1042+1926+= 5095 summarises the computation time with the Central Authority first (when there is one), next truck 0, truck 1, etc. and 5095 is the total time (which may be smaller than the addition in Column 6 because of concurrency, as explained in the Section 6 in the article).
- Column 8 (maxReallocations)
- Columns 9 and 10: 80+75+62+69+= 286 summarises the route length of truck 0 (80), truck 1 (75), truck 2 (62) and truck 3 (69) and 286 is the sum of these m route lengths

After many runs of "ParamVar: Main", the content of MTSP\anylogic\output.csv has been copier/pasted into the Excel file in MTSP\results\ corresponding to the experimented mechanism.

*******************************************

4/ GENERATION OF THE FIGURES BY R

These Excel files were finally converted into EPS image by R:

4.1 Install RStudio, next packages gdata, ggplot2 and xlsx.

4.2 In one of the subdirectories of MTSP\figures\, double-click the .R file, e.g., in MTSP\figures\rations-24h-OptDecentr, double-click rations-24h-OptDecentr.R, which opens it in RStudio. Next click on the first line and press ctrl+enter until the cursor reacehs the last line and wait (this will load all Excel files in memory, which may take quite a long while; lines such as "1/7 => FullCentr" are displayed whenever a file has been loaded). When everything has been done, an EPS image file appears in the same directory (or 7 files when you generate boxplots). Change line "m <- 5" or "m <- 9", and "proba <- 0.5" or "proba <- 0.9" to generate the 3 other figures.

4.3 Before generating the images in another directory, close the current .R file (ctrl+w) and RStudio (alt+F4) and click "Don't Save" (it is important not to save the working directory).
